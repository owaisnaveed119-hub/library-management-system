<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Library Management System</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f2f5;
    }

    header {
      background: #4a90e2;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }

    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
    }

    h2 {
      color: #333;
    }

    input {
      padding: 8px 12px;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    button {
      padding: 8px 15px;
      margin: 5px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    button:hover {
      background: #357ABD;
    }

    .card {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .card b {
      font-size: 16px;
      color: #333;
    }

    .card span {
      color: #777;
      margin-left: 10px;
    }

    .status {
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: bold;
      font-size: 12px;
    }

    .available { background: #d4edda; color: #155724; }
    .borrowed { background: #f8d7da; color: #721c24; }

    .panel-toggle button {
      background: #50c878;
    }

    .panel-toggle button:hover {
      background: #3da75a;
    }

    .flex {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
    }

    .flex > div { flex: 1; }

    #adminPanel, #userPanel { display: none; }
  </style>
</head>
<body>

<header>Library Management System</header>

<div class="container">
  <div class="panel-toggle">
    <button onclick="showAdmin()">Admin Panel</button>
    <button onclick="showUser()">User Panel</button>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <h2>Admin Login</h2>
    <div class="flex">
      <input id="adminUser" placeholder="Username">
      <input id="adminPass" type="password" placeholder="Password">
      <button onclick="adminLogin()">Login</button>
    </div>

    <div id="adminActions" style="display:none;">
      <h2>Admin Panel</h2>
      <div class="flex">
        <input id="bookTitle" placeholder="Book Title">
        <input id="bookAuthor" placeholder="Author Name">
        <button onclick="adminAddBook()">Add Book</button>
      </div>
      <h3>All Books</h3>
      <div id="adminBooks"></div>
    </div>
  </div>

  <!-- User Panel -->
  <div id="userPanel">
    <h2>Enter Your Name</h2>
    <div class="flex">
      <input id="userName" placeholder="Your Name">
      <button onclick="startUser()">Start</button>
    </div>

    <div id="userActions" style="display:none;">
      <h2>Welcome, <span id="currentUser"></span></h2>
      <h3>Books</h3>
      <div id="userBooks"></div>
    </div>
  </div>
</div>

<script>
const API = "http://127.0.0.1:5000";

// Show panels
function showAdmin(){ document.getElementById("adminPanel").style.display="block"; document.getElementById("userPanel").style.display="none";}
function showUser(){ document.getElementById("userPanel").style.display="block"; document.getElementById("adminPanel").style.display="none";}

// Admin Login
function adminLogin(){
 let u=document.getElementById("adminUser").value;
 let p=document.getElementById("adminPass").value;
 fetch(API+"/admin/login",{method:"POST",headers:{'Content-Type':'application/json'},
 body:JSON.stringify({username:u,password:p})})
 .then(res=>res.json()).then(d=>{
   if(d.success){alert("Login successful"); document.getElementById("adminActions").style.display="block"; loadAdminBooks();}
   else alert("Wrong credentials");
 });
}

// Admin actions
function loadAdminBooks(){
 fetch(API+"/admin/books").then(res=>res.json()).then(data=>{
   let html="";
   data.forEach((b,i)=>{
     html+=`<div class="card"><div><b>${b.title}</b> by <span>${b.author}</span></div>
     <div><span class="status ${b.available?"available":"borrowed"}">${b.available?"Available":"Borrowed"}</span>
     <button onclick="adminDeleteBook(${i})">Delete</button></div></div>`;
   });
   document.getElementById("adminBooks").innerHTML=html;
 });
}

function adminAddBook(){
 let title=document.getElementById("bookTitle").value;
 let author=document.getElementById("bookAuthor").value;
 if(!title || !author){ alert("Enter both fields"); return;}
 fetch(API+"/admin/books",{method:"POST",headers:{'Content-Type':'application/json'},
 body:JSON.stringify({title,author})})
 .then(res=>res.json()).then(d=>{alert(d.message); loadAdminBooks();});
}

function adminDeleteBook(i){
 fetch(API+"/admin/books/"+i,{method:"DELETE"}).then(res=>res.json()).then(d=>{alert(d.message); loadAdminBooks(); loadUserBooks();});
}

// User actions
function startUser(){
 let name=document.getElementById("userName").value;
 if(!name){alert("Enter your name"); return;}
 document.getElementById("currentUser").innerText=name;
 document.getElementById("userActions").style.display="block";
 loadUserBooks();
}

function loadUserBooks(){
 fetch(API+"/books").then(res=>res.json()).then(data=>{
   let html="";
   data.forEach((b,i)=>{
     html+=`<div class="card"><div><b>${b.title}</b> by <span>${b.author}</span></div>
     <div><span class="status ${b.available?"available":"borrowed"}">${b.available?"Available":"Borrowed"}</span>`;
     if(b.available) html+=`<button onclick='borrowBook(${i})'>Borrow</button>`;
     else html+=`<button onclick='returnBook(${i})'>Return</button>`;
     html+=`</div></div>`;
   });
   document.getElementById("userBooks").innerHTML=html;
});

}

function borrowBook(i){ fetch(API+"/books/"+i+"/borrow",{method:"POST"}).then(res=>res.json()).then(d=>{alert(d.message); loadUserBooks(); loadAdminBooks();});}
function returnBook(i){ fetch(API+"/books/"+i+"/return",{method:"POST"}).then(res=>res.json()).then(d=>{alert(d.message); loadUserBooks(); loadAdminBooks();});}

</script>
</body>
</html>
